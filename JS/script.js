var Fourier_portrait = [[384.69869384765616,374.24409179687495],[390.32039794921866,372.2076873779297],[396.33504028320306,373.2578582763672],[402.16451416015616,375.1420989990234],[408.2825927734375,375.2957794189453],[414.40763549804683,375.1041595458984],[420.528662109375,374.8053009033203],[426.6533203125,374.72329101562497],[432.77071533203116,375.0614562988281],[438.89827880859366,375.02928466796874],[445.01422119140625,374.65602111816406],[451.0676147460937,373.7301574707031],[451.8804077148437,371.9078674316406],[445.9454467773437,370.4589904785156],[439.93853759765625,369.5989227294922],[434.01912841796866,371.17296142578124],[428.1216796875,370.9768981933594],[422.14262695312493,369.74523315429684],[416.1234130859375,370.71100158691405],[410.44099731445306,373.0004425048828],[404.7793029785156,375.1935607910156],[408.1876586914062,378.70545959472656],[413.6149658203125,381.5347900390625],[419.472509765625,383.3001281738281],[425.56999511718743,383.757666015625],[431.6850830078124,383.3565246582031],[437.6420043945312,382.0528259277344],[443.07674560546866,379.22926330566406],[448.3546020507812,376.11489562988277],[453.69329833984375,373.1132141113281],[457.0488037109375,376.0256866455078],[456.98138427734375,381.9543029785156],[460.2604125976562,376.8714630126953],[462.8046630859375,371.2969268798828],[463.65471191406243,365.2409271240234],[463.46578369140616,359.1219085693359],[462.0842407226562,353.18446960449216],[458.30900878906243,348.3946990966797],[453.595458984375,344.483560180664],[449.08955078124995,340.46727600097654],[447.04244384765616,334.69097290039065],[445.05181884765625,328.8949951171875],[443.134765625,323.0743225097656],[441.3364013671875,317.21600952148435],[439.83454589843745,311.27679748535155],[444.44222412109366,310.7839050292969],[449.7596435546875,313.82611083984375],[455.1457641601562,316.6531127929687],[461.164892578125,315.8049652099609],[466.8203491210937,313.4581665039062],[472.19527587890616,310.5179443359375],[475.20317382812493,306.1552490234375],[470.40631103515625,302.53457336425777],[464.98652343749995,304.27688293457027],[459.1042846679687,305.8436798095703],[452.9952636718749,305.54881591796874],[446.9779296874999,304.3983276367187],[441.05168457031243,302.84069519042964],[437.74274902343745,299.1086151123047],[437.0706909179687,293.0176239013672],[436.8464721679687,286.90039978027346],[438.272705078125,280.9813751220703],[442.2395141601562,276.39061584472654],[447.16890869140616,272.7531494140625],[452.5284545898437,269.7989135742188],[458.44111328124995,268.2990020751953],[464.500830078125,268.9749053955078],[469.8160278320312,271.8167327880859],[473.94775390625,276.3402435302734],[477.85175781249995,281.0639190673828],[481.6466430664062,285.8757568359375],[481.0761840820312,290.6880859375],[476.79013671875,295.05565185546874],[471.5856811523437,294.1959259033203],[466.8787963867187,290.27162780761716],[461.8819824218749,286.7359741210937],[455.95941162109375,285.8955596923828],[449.8995239257812,286.7932891845703],[443.9955810546875,288.4063781738281],[440.2616210937499,292.8469818115234],[438.833251953125,298.78700561523436],[443.21269531249993,295.4567504882813],[446.9602416992187,297.74909667968745],[452.6102294921875,298.54766235351565],[455.3161499023437,293.5526641845703],[458.4726440429687,292.39662170410156],[463.94378662109375,295.14133605957034],[469.0885986328125,298.46857910156245],[474.5472656249999,301.1370086669922],[480.13897705078125,303.63996582031245],[485.38872070312493,306.7878936767578],[489.343994140625,311.35451354980466],[489.62939453125,317.4566772460937],[489.80439453124995,323.5824676513672],[490.70733642578125,329.0614929199219],[496.8299438476562,328.93656616210933],[502.86727294921866,327.9287139892578],[508.50205078125,325.5809326171875],[512.6013916015625,321.1358215332031],[513.6828369140625,315.1566192626953],[513.097509765625,309.0640472412109],[511.74202880859366,303.08958740234374],[510.04816894531245,297.20021362304686],[508.51213378906243,291.2707214355469],[511.32084960937493,287.2255126953125],[516.3047607421875,283.7217315673828],[520.5023681640624,279.26100463867186],[524.3236572265624,274.47123413085933],[522.3590087890625,274.6236968994141],[516.6440795898437,276.81574707031245],[510.66682128906245,278.148648071289],[510.8940307617187,276.48732299804686],[514.485546875,271.5385101318359],[517.2441040039062,266.07020874023436],[519.3771728515625,260.328630065918],[520.6463500976562,254.34432220458984],[521.0142944335937,248.22907409667968],[519.4328002929688,242.46340942382812],[514.726171875,238.5896224975586],[509.2971557617187,235.75370178222656],[511.7838134765625,232.25058288574218],[514.710791015625,226.90831909179687],[515.8829833984374,220.909228515625],[515.7680541992187,214.79049835205078],[514.6539672851562,208.77017364501953],[512.7002563476562,202.96658020019532],[510.00177001953125,197.4692153930664],[506.62191162109366,192.36225738525388],[502.6198974609374,187.72750244140624],[497.77449951171866,184.01317443847654],[491.866796875,183.2815902709961],[488.5678588867187,185.3593307495117],[489.74560546875,179.35211181640625],[489.9188110351562,173.23425750732423],[488.88872070312493,167.20582046508787],[486.42487792968745,161.61468048095702],[482.5313842773437,156.90688781738282],[477.6766723632812,153.18543548583983],[472.0975219726562,150.69043045043946],[466.0587402343749,149.77382202148436],[461.2597412109375,149.23127822875978],[460.60272216796875,143.16298446655273],[458.01984863281245,137.64103164672852],[453.6498901367187,133.3906219482422],[448.1578125,130.71712951660157],[442.10664062499995,130.00826416015624],[436.14339599609366,131.3275894165039],[430.63200683593743,133.9879119873047],[425.5023193359375,137.33878173828126],[424.7400268554687,134.08565521240234],[423.86810302734375,128.05966415405274],[421.4878295898437,122.4198314666748],[418.42985839843743,117.11161918640136],[414.9474182128906,112.0706573486328],[414.29902954101556,116.1145523071289],[413.13140869140625,122.11666831970214],[410.4725708007812,127.61478080749512],[406.28205566406245,132.0505271911621],[400.7495178222656,134.52870407104493],[394.73444824218745,133.76715927124025],[389.2960327148437,130.96647567749022],[384.2108215332031,127.54721717834472],[379.09061889648433,124.18160209655761],[373.64485473632806,121.38444061279296],[367.75065307617183,119.77004051208496],[361.63518066406243,119.59560661315918],[355.64728393554685,120.81619796752929],[350.25240478515616,123.67187614440917],[346.0562927246093,128.09539260864258],[341.2152099609375,125.94173851013184],[335.12921752929685,125.79701957702636],[329.2248474121093,127.39849548339843],[323.6908996582031,130.01142044067382],[318.8672058105468,133.76323394775392],[315.3875854492187,138.77106018066405],[313.4791198730468,144.02937545776368],[307.3891967773437,144.56588439941407],[301.51751098632803,146.29438323974608],[295.9858276367187,148.91954345703124],[290.85575561523433,152.2639404296875],[286.5239074707031,156.5750617980957],[283.3896728515624,161.82433013916017],[281.4753540039062,167.63501052856446],[280.66764526367183,173.7021026611328],[278.6503601074219,178.6095260620117],[273.7598022460937,182.29089202880857],[269.4719604492187,186.6623992919922],[265.8016174316406,191.56483459472656],[262.8749816894531,196.93812713623046],[261.0483337402343,202.7798629760742],[260.09574584960933,208.82978515625],[259.80107421874993,214.94871826171874],[260.02999267578116,221.07117614746093],[260.7330688476562,227.1572540283203],[257.1368103027344,231.72210083007812],[253.56157226562493,236.69005432128904],[250.99531860351556,242.24242706298827],[249.87114868164053,248.23995819091795],[250.97361450195308,254.24042663574218],[253.54755859374995,259.791731262207],[256.9517700195312,264.8825927734375],[260.7958740234375,269.5090911865234],[255.41928100585938,272.43036499023435],[250.99168701171868,276.61487731933596],[249.4721862792968,282.45671997070315],[250.19453124999995,288.52679748535155],[252.19562377929685,294.30908203125],[255.21561279296873,299.6326965332031],[259.0761657714843,304.3837371826172],[263.60860595703116,308.50059509277344],[262.6165832519531,313.81775817871096],[262.30473632812493,319.91088562011714],[263.60454711914053,325.8885070800781],[265.8429321289062,331.58955078124995],[268.5677795410156,337.0759033203125],[272.9289794921874,341.3243957519531],[278.28955078125,344.27728576660155],[284.0167419433593,346.4483367919922],[288.0226867675781,350.50108642578124],[290.2680786132812,356.1927093505859],[289.91829223632806,362.1041290283203],[284.31914672851553,364.35667724609374],[278.80378417968745,366.99005126953125],[274.4462585449219,371.2421966552734],[272.1301574707031,376.8737487792969],[271.6480529785156,382.9724945068359],[270.9361328125,389.056884765625],[269.8354614257812,395.0850067138672],[268.54351196289053,401.07546691894527],[267.1340270996093,407.03941650390624],[265.64545898437495,412.98420410156245],[264.1034851074219,418.9153411865234],[262.5239562988281,424.83660888671875],[260.9239624023437,430.75238647460935],[259.32255859374993,436.6678009033203],[257.75054931640625,442.5909912109375],[253.34051513671875,445.865576171875],[248.13554687499993,449.07116088867184],[243.77310791015623,453.3602416992187],[240.2603759765625,458.3733764648437],[237.58585815429683,463.8795532226562],[236.2894226074219,469.73414916992186],[231.74856567382812,473.74603271484375],[226.11250610351556,476.1366027832031],[220.85139770507806,479.2710083007812],[215.87150268554683,482.8412902832031],[211.05451660156245,486.62929687499997],[206.3517333984375,490.5585083007812],[201.74234619140623,494.596923828125],[197.2164428710937,498.728564453125],[192.77697143554684,502.9529602050781],[188.4432434082031,507.2855773925781],[184.3001098632812,511.7998168945312],[180.20542602539058,516.3472106933593],[175.58561401367183,520.3724670410156],[170.83066406249998,524.2384460449218],[166.0463195800781,528.0681518554687],[161.28517456054686,531.9265258789062],[156.59213256835932,535.8674011230469],[152.02282104492184,539.9505493164063],[147.6694396972656,544.2625305175782],[143.73172607421873,548.952880859375],[140.31089477539058,554.0368530273438],[137.08437499999997,559.24677734375],[133.98679809570308,564.5345458984375],[131.00180053710938,569.8866149902344],[128.1231018066406,575.2965332031249],[125.35048828124997,580.7617797851562],[122.68767700195309,586.2811157226563],[120.14218749999998,591.8556518554688],[117.72269287109373,597.4859436035156],[115.44320678710938,603.1744262695312],[113.319580078125,608.9226806640625],[111.37492675781249,614.73408203125],[109.6358642578125,620.6099121093749],[108.1406311035156,626.552734375],[106.93827514648433,632.5610534667968],[106.0949768066406,638.6300415039062],[105.70182495117183,644.7439331054687],[105.56681518554683,650.8708557128906],[105.41873168945312,656.997265625],[105.26261596679683,663.1237609863281],[105.09979248046875,669.2498291015625],[104.9320129394531,675.375811767578],[104.76000366210934,681.5017944335937],[104.58799438476558,687.6276489257812],[104.41683959960938,693.7535888671874],[104.24837646484372,699.8796569824218],[104.08551025390625,706.0057678222656],[103.93157348632809,712.1320922851562],[103.79404296874998,718.2590576171874],[103.6827453613281,724.3861511230468],[103.6204956054687,730.51435546875],[103.70158691406249,736.6414062499999],[107.14360961914059,740.9964111328125],[113.01849975585935,742.7240234374999],[119.0029357910156,744.0434448242187],[125.00031738281245,745.3034790039062],[130.97390136718747,746.6703247070312],[136.8719055175781,748.3296203613281],[142.66805419921872,750.3187927246094],[148.42553710937494,752.4185791015625],[154.16734008789058,754.5601928710937],[159.90529785156247,756.7127014160155],[165.64432373046873,758.8615783691406],[171.39121093749998,760.9905029296874],[177.14967651367186,763.0866149902344],[182.92540283203124,765.1357299804687],[188.72561035156247,767.1137084960938],[194.56051025390622,768.9873535156249],[200.44535522460933,770.6955688476562],[206.40949707031245,772.0996276855468],[212.35466918945315,773.5818725585937],[218.21635742187493,775.3680603027343],[224.02322998046873,777.3266418457031],[229.7961364746094,779.3831909179687],[235.55391845703127,781.4819946289062],[241.31383666992178,783.574560546875],[247.09797973632806,785.5994079589843],[252.9381347656249,787.4543823242187],[258.8939453124999,788.8841613769531],[264.82450561523433,788.3011413574218],[268.11002807617183,783.2328491210938],[269.60504760742185,777.2977600097656],[270.37007446289056,771.2191589355468],[270.7301147460937,765.1022338867188],[270.82415161132803,758.9749267578125],[270.67854614257806,752.8511657714844],[269.83623046874993,746.7818359375],[268.80891723632806,740.7403625488281],[267.7405883789062,734.7059814453124],[266.6920410156249,728.66796875],[265.7471862792968,722.6131225585937],[265.09969482421866,716.5199951171875],[264.6727478027343,710.4067443847656],[264.4146484375,704.2840515136718],[264.3498352050781,698.1564880371093],[264.54585571289056,692.0319580078125],[265.1465209960937,685.9351989746093],[266.34148559570303,679.9259826660156],[267.7868591308593,673.9707275390624],[269.2595336914062,668.0218811035156],[270.60980224609375,662.0446228027344],[271.60930175781243,656.0004150390624],[271.48762207031245,649.9032287597656],[269.48858032226553,644.1180603027343],[266.9244201660156,638.5527954101562],[264.1582153320312,633.08447265625],[261.66754150390625,627.5856872558593],[266.3443908691406,631.5165222167968],[269.9946533203124,636.4241271972655],[272.6156372070312,641.9546997070312],[274.35200805664056,647.8271545410156],[275.38436279296866,653.8649963378906],[275.8683044433593,659.9727783203125],[275.92388916015625,666.0996582031249],[275.64408569335933,672.221026611328],[275.09844970703125,678.3245788574218],[274.3479064941406,684.4066406249999],[273.4519287109374,690.4689636230469],[272.49639282226553,696.5222717285155],[271.7281188964844,702.6002319335937],[271.9093994140625,708.723095703125],[272.30571289062493,714.8387390136718],[272.71881713867185,720.953057861328],[273.10624389648433,727.069171142578],[273.4447082519531,733.1879760742187],[273.7160949707031,739.3103698730469],[273.9062622070312,745.4356689453125],[273.9967102050781,751.563232421875],[273.9693664550781,757.6912658691406],[273.79876708984375,763.8171203613281],[273.45158691406243,769.9353698730469],[272.88313598632806,776.0368286132812],[272.1412231445312,782.1197448730468],[271.70231323242183,788.2306030273437],[272.16925048828125,794.3243713378906],[275.7444030761718,799.0086120605469],[281.69636840820306,800.3857543945312],[287.71720581054683,801.5155639648438],[293.5777404785156,803.3002563476562],[299.5576049804687,804.6267700195312],[305.62655029296866,805.4723754882812],[311.72796630859375,806.0412109375],[317.84318237304683,806.4409423828124],[323.9643371582031,806.7346313476562],[330.08831176757803,806.9656005859374],[336.2133972167968,807.1645263671875],[342.33882446289056,807.3576416015625],[348.46356811523435,807.5617797851562],[354.5874145507812,807.7965942382812],[360.7092529296874,808.0766967773437],[366.82784423828116,808.4208862304687],[372.9414367675781,808.8447998046875],[379.05208129882806,809.31015625],[385.1684936523437,809.6922851562499],[391.2892211914062,809.9929809570312],[397.41349487304683,810.21591796875],[403.53999023437495,810.3627197265624],[409.66789550781243,810.43466796875],[415.7960571289062,810.4266357421875],[421.92387695312493,810.3358032226562],[428.0493041992187,810.1534545898437],[434.1708007812499,809.8660034179687],[440.2852905273437,809.455419921875],[446.3873046875,808.8901733398437],[452.46650390624995,808.1201904296875],[458.4990478515624,807.0473754882812],[464.4095703124999,805.44306640625],[466.6816650390624,800.7745483398437],[467.1149780273437,794.6616821289062],[467.6087890624999,788.5534301757812],[467.98066406249995,782.4365905761719],[468.00860595703125,776.3102233886718],[467.61126708984375,770.1949645996093],[467.2501586914062,764.0772705078125],[466.91203613281243,757.9581665039062],[466.5897216796875,751.8384216308593],[466.2784301757812,745.7180358886718],[465.97918701171875,739.5970520019531],[465.7042114257812,733.4748718261718],[461.1230224609375,731.1609924316406],[456.02409667968743,732.9077880859375],[453.3180053710937,738.4020019531249],[449.27130126953125,742.8898376464844],[443.4491333007812,744.7084533691406],[437.3409667968749,745.0695190429688],[431.3028686523437,744.1353027343749],[427.115087890625,740.0513427734375],[425.26579589843743,734.2202026367187],[424.7972778320312,728.1288696289062],[426.4925903320312,722.2964477539062],[430.79794921875,718.0083068847656],[436.28105468749993,715.3260131835937],[442.33590087890616,714.7613647460937],[447.7521850585937,717.3769653320312],[452.1658935546875,721.5585083007812],[457.8957763671874,723.6542358398438],[463.31795654296866,723.5995910644531],[462.2970092773437,717.5570495605468],[461.2291503906249,711.5223693847656],[460.095068359375,705.4999938964843],[458.8248657226562,699.5050048828125],[457.04794921875,693.6438293457031],[454.9427368164062,687.8884826660155],[452.7568603515624,682.163427734375],[450.5427001953125,676.44892578125],[448.3343505859375,670.732501220703],[446.2094848632812,664.9846740722655],[444.7346313476562,659.039630126953],[443.3427490234375,653.07138671875],[441.8458496093749,647.12890625],[440.0144165039062,641.2844360351562],[435.014013671875,638.4944763183594],[428.9302856445312,639.0467773437499],[425.4636108398437,643.5187194824218],[422.69830322265625,648.9448303222656],[417.9309204101562,652.7007934570312],[411.9296936035156,653.593096923828],[406.02045288085935,652.0715454101562],[400.8359069824219,648.854425048828],[398.4544372558594,643.3919982910156],[398.8243469238281,637.297930908203],[400.95634765624993,631.5799255371094],[405.1263549804687,627.1784362792969],[410.99846801757803,625.685382080078],[417.11821289062493,625.5313171386719],[422.2291015625,628.3743408203125],[425.7813964843749,632.8522644042969],[431.2140014648437,630.292333984375],[432.3601318359374,625.0139221191406],[430.0549682617187,619.3359069824219],[427.63188476562493,613.7072814941406],[425.1505249023437,608.1036926269531],[422.6213134765625,602.5217651367187],[420.0369873046875,596.9647033691406],[417.3621704101562,591.4515197753906],[414.7806213378906,585.8936889648437],[412.2662353515625,580.3047119140624],[409.7431762695312,574.7198364257813],[407.15876464843745,569.1632873535157],[404.4531005859375,563.6646301269532],[401.49933471679685,558.2966674804687],[397.814208984375,553.4261474609375],[392.2797912597656,551.204296875],[388.1950622558593,554.3395568847657],[387.9797302246093,560.4575927734375],[386.6364685058593,566.4234008789062],[383.59990234374993,571.693780517578],[378.1705444335937,574.4561401367187],[372.1732055664062,575.6310241699218],[366.1934692382812,574.6419067382812],[362.53619995117185,569.9681762695312],[360.85759277343743,564.0776062011719],[360.38176879882803,557.9928955078125],[362.798828125,552.482958984375],[367.94658813476553,549.2562683105468],[373.9120971679687,547.9770935058593],[379.9928344726562,548.624200439453],[385.51738281249993,546.7974243164062],[389.2993225097656,541.9866760253906],[390.05375366210933,536.0624816894531],[387.826904296875,530.371435546875],[385.18062744140616,524.9991149902344],[379.60416870117183,522.5771850585937],[374.61760864257803,519.0889770507813],[370.8668579101562,514.2584045410156],[368.03143920898435,508.83173828124995],[365.95856933593745,503.06891479492185],[364.4870483398437,497.12113647460933],[362.69453735351556,491.2617553710937],[360.6989990234374,485.4674438476562],[358.5904541015625,479.7132934570312],[356.3957763671874,473.99122924804686],[354.12346801757803,468.30009765625],[351.7660095214843,462.6433166503906],[349.2952880859375,457.035498046875],[346.60893554687493,451.52855224609374],[343.93659667968745,446.03314208984375],[342.6557556152343,440.0477874755859],[341.97651977539056,433.95741577148436],[340.2295959472656,428.2335998535156],[335.0547912597656,424.95072631835933],[329.82269287109375,421.7599670410156],[324.5439819335937,418.64683837890624],[319.2120361328125,415.6265502929687],[313.8104492187499,412.73180847167964],[308.30730590820303,410.03676147460936],[302.9026000976562,407.1537902832031],[297.8472961425781,403.6960235595703],[293.26093749999995,399.6382751464844],[289.297119140625,394.97174377441405],[286.147802734375,389.72398681640624],[283.8423828125,384.0484924316406],[282.2507202148437,378.1448272705078],[283.68229370117183,372.33878784179683],[288.0241394042969,373.0042449951172],[292.5404296874999,377.14686584472656],[296.969091796875,381.3824768066406],[301.2452697753906,385.7718109130859],[304.9876892089843,390.6026184082031],[309.05806274414056,395.1255737304687],[313.74837036132806,399.0692260742187],[318.551513671875,402.87526245117186],[323.40302124023435,406.61943359375],[328.27396850585933,410.33811950683594],[333.1418395996093,414.06127014160154],[337.96818237304683,417.8373138427734],[342.4327758789062,422.00257873535156],[345.37261352539053,427.37440795898436],[347.8774291992187,432.96686706542965],[349.96367187499993,438.7248840332031],[353.36848144531245,443.6433410644531],[357.38237304687493,448.2743041992187],[361.39374389648435,452.90770263671874],[365.39742431640616,457.54686889648434],[369.3917053222656,462.19513549804685],[373.31181640624993,466.9030883789062],[376.014404296875,472.3903381347656],[378.0678771972656,478.16320190429684],[379.9340881347656,484.0003662109375],[381.7913696289062,489.84069213867184],[383.77020263671875,495.6403442382812],[386.0339660644531,501.3336547851562],[388.91463012695306,506.73554077148435],[392.69268188476553,511.54902343749995],[397.4193481445312,515.4241882324218],[403.04045410156243,517.7942504882812],[409.12371215820303,517.940966796875],[415.0942626953124,516.5727966308593],[421.1489379882812,515.6313598632812],[427.2255737304687,514.8368103027344],[433.3072509765625,514.082080078125],[439.38653564453125,513.3050048828125],[445.4524047851562,512.437353515625],[451.48383789062495,511.35556640625],[457.3455688476562,509.6113342285156],[461.004248046875,504.9354248046875],[461.69869384765616,498.86665039062495],[461.4026977539062,492.7474182128906],[460.809423828125,486.6478820800781],[460.1739379882812,480.5527893066406],[459.62116699218745,474.44936523437497],[459.35405273437493,468.3294494628906],[459.8221435546875,462.2230346679687],[461.0332153320312,456.2194580078125],[462.8937011718749,450.38310546875],[465.2458618164062,444.7252563476562],[467.8508666992187,439.1781921386719],[470.2773681640624,433.56298217773434],[474.3492797851562,428.98290405273434],[478.86518554687495,426.0199310302734],[484.4944091796874,428.41633300781245],[489.2470947265624,432.2404418945312],[492.5614135742187,437.36957397460935],[494.57861328125,443.14658203125],[495.7027832031249,449.16686401367184],[496.2320556640625,455.2709716796875],[496.5959838867187,461.3822998046875],[497.8928466796874,467.3701538085937],[499.48544921875,473.28764038085933],[501.19674072265616,479.1718872070312],[502.96502685546875,485.0397705078125],[504.75493164062493,490.9011596679687],[506.5351806640624,496.7648559570312],[508.25518798828125,502.6468811035156],[509.73798828124995,508.5911987304687],[510.36663818359375,514.6850524902343],[510.80635986328116,520.7972778320312],[511.4681640624999,526.8878845214844],[514.4970825195312,531.9484008789062],[519.1334716796874,535.95537109375],[523.8433471679687,539.8764221191407],[528.636962890625,543.6942077636718],[533.569775390625,547.3295593261719],[538.7585083007812,550.2844787597655],[539.1370483398437,556.4011901855469],[539.5155029296875,562.5180297851562],[539.8937866210937,568.6347412109375],[540.27548828125,574.7508972167968],[540.66650390625,580.8667541503905],[541.0710205078125,586.9819702148437],[541.4978393554687,593.0954772949219],[542.0409545898438,599.1992004394531],[542.6318359375,605.2992492675781],[543.2117797851562,611.4002380371094],[543.7471191406249,617.5048583984375],[544.2088012695312,623.6155029296874],[544.5563232421874,629.7339233398437],[544.7220947265624,635.8596923828125],[544.55615234375,641.9842651367187],[543.4820556640625,647.9966857910156],[540.489453125,653.3344848632812],[536.91904296875,658.3141662597656],[533.2659179687499,663.2340759277344],[529.8717895507812,668.3344970703124],[527.23935546875,673.8565673828125],[525.19541015625,679.632080078125],[522.841796875,685.2897155761718],[520.3498413085937,690.8883483886718],[517.7668823242187,696.4458374023437],[515.103857421875,701.9651306152343],[512.3526489257812,707.4411010742188],[509.4601928710937,712.8433288574219],[505.74443359374993,717.6611694335937],[500.5831298828125,720.9483581542968],[495.7977172851562,724.6571105957031],[497.3371704101562,730.2380981445312],[500.61372070312495,735.4063659667968],[502.3969604492187,741.244384765625],[502.67108154296875,747.3603271484375],[502.77490234375,753.4878479003905],[502.9397338867187,759.6140014648437],[503.1396850585937,765.7387878417968],[503.3490356445312,771.8636596679687],[503.5324951171874,777.9892578125],[503.73236083984375,784.112890625],[504.24676513671875,790.2192626953124],[504.8073974609374,796.3217468261719],[505.7071777343749,801.8019042968749],[511.7880004882812,801.045166015625],[517.8598510742187,800.21357421875],[523.9215332031249,799.3122985839843],[529.9716796875,798.3366821289062],[536.0071289062499,797.2751037597656],[542.0236083984374,796.110430908203],[548.0144531249999,794.8187377929687],[553.9653076171875,793.355419921875],[559.848828125,791.6447692871093],[565.5945190429687,789.5196899414062],[570.9751708984375,786.6026672363281],[575.9748901367187,783.0615234375],[580.7612426757812,779.2354919433593],[585.4082275390624,775.2402709960937],[589.9531005859375,771.1296081542969],[594.4188476562499,766.9328979492187],[598.8186279296874,762.6671447753906],[603.1636352539061,758.3454223632812],[607.4563476562499,753.9714477539062],[611.6967651367187,749.5475280761718],[616.4009155273437,745.6726196289062],[621.4553222656249,742.2070129394531],[626.4379516601562,738.6395935058594],[631.2639526367187,734.8641479492187],[635.7814819335937,730.7269958496094],[639.5411621093749,725.9091979980468],[640.5380126953124,720.0078186035156],[640.0206176757812,713.9018310546875],[639.5761962890624,707.7893920898437],[639.1674926757812,701.6746887207031],[638.7764770507812,695.5593017578125],[638.39853515625,689.4424194335937],[638.0298217773437,683.3251525878906],[637.6679443359375,677.2072448730469],[637.3093139648437,671.089678955078],[636.9505981445312,664.9719848632812],[636.5917968749999,658.8540771484375],[636.2243652343749,652.7366821289062],[635.8195922851562,646.6218078613281],[634.7548950195312,640.5944763183593],[633.2084350585936,634.6645996093749],[631.4846679687499,628.7837280273437],[629.6270019531249,622.9442993164062],[627.6385131835937,617.1476379394531],[625.4974975585936,611.4054077148437],[623.1512329101562,605.744952392578],[620.45625,600.2433898925781],[616.7738159179687,595.4029479980469],[612.5762939453124,591.0320495605469],[609.2089111328124,585.9134704589844],[606.0415649414061,580.6671020507813],[602.975048828125,575.3609191894532],[599.9709106445312,570.0196166992187],[597.0101806640624,564.6543029785156],[594.0782470703125,559.2726684570312],[591.1665649414062,553.880224609375],[588.2680419921875,548.4806030273437],[585.3728515624999,543.0793579101562],[582.47578125,537.6791809082031],[579.5605102539062,532.2885314941407],[576.5983276367188,526.9239013671875],[573.4332885742188,521.6790283203125],[568.4284423828125,518.212353515625],[562.994384765625,515.3798400878907],[557.4862426757812,512.6942565917968],[551.9390502929687,510.08925170898436],[546.3652832031249,507.5417114257812],[540.76904296875,505.0441589355469],[535.1443481445312,502.61210327148433],[531.6798095703125,497.85343627929683],[529.62509765625,492.08082885742186],[527.8154541015624,486.2257629394531],[526.1303100585938,480.33416748046875],[524.5243774414062,474.4199279785156],[522.9775756835937,468.4899658203125],[521.4771728515625,462.54833984375],[520.0177856445312,456.5962890625],[518.597021484375,450.6349243164062],[517.2165893554687,444.6639038085937],[515.8959716796875,438.68004455566404],[512.9144775390624,433.8706634521484],[507.85528564453125,430.41234130859374],[502.8189941406249,426.9205017089844],[497.8108154296874,423.3889495849609],[492.84151611328116,419.80275268554686],[487.9380981445312,416.1267486572265],[483.20369873046866,412.23797607421875],[481.57170410156243,406.78832397460934],[482.2417114257812,400.6969055175781],[483.01400146484366,394.61712951660155],[483.8238891601562,388.54299316406247],[484.6518920898437,382.47084350585936],[485.48519287109366,376.3990570068359],[486.31669921874993,370.3274841308594],[487.1401733398437,364.2549713134765],[487.94245605468745,358.1794891357422],[488.7077392578125,352.09898681640624],[489.3898803710937,346.00859375],[489.62298583984375,339.9068359375],[488.70500488281243,345.8399383544922],[487.691748046875,351.88397521972655],[486.55159912109366,357.9051330566406],[485.28037109375,363.89980163574216],[483.8729370117187,369.86437072753904],[482.32041015625,375.7924530029297],[480.61040039062493,381.67731933593745],[478.7271850585937,387.50873718261715],[476.649658203125,393.2739318847656],[474.35295410156243,398.9549163818359],[471.8049438476562,404.52757263183594],[468.9640136718749,409.9568878173828],[465.77983398437493,415.19135742187495],[462.1893432617187,420.1554870605469],[458.12067871093745,424.733364868164],[453.5029174804687,428.75462646484374],[448.29461669921875,431.96508178710934],[442.53986816406245,434.0638214111328],[436.5995239257812,435.558349609375],[430.53621826171866,436.43044433593747],[424.41557617187493,436.67873840332027],[418.29997558593743,436.31972351074216],[412.2455993652343,435.3869171142578],[406.2960266113281,433.9253936767578],[400.48419799804685,431.9865509033203],[394.83100585937495,429.6242431640625],[389.3482421875,426.88890686035154],[384.03988037109366,423.8283508300781],[378.8714416503906,420.5354797363281],[373.68305053710935,417.2745452880859],[368.4519348144531,414.08158569335933],[363.1769836425781,410.9622833251953],[357.85798339843745,407.9184967041015],[352.49578857421875,404.9519989013672],[347.0940307617187,402.0572143554687],[341.6624938964843,399.218911743164],[336.22185668945303,396.3986602783203],[330.8125366210937,393.5188507080078],[325.52058105468745,390.43041687011714],[320.6230590820312,386.76447448730465],[316.7545166015625,382.03436889648435],[314.2159484863281,376.47352600097656],[312.9859497070312,370.4807159423828],[311.5611694335937,365.43402099609375],[305.63838500976556,363.9520751953125],[300.98101806640625,360.08962097167966],[298.0678833007812,354.7075592041015],[295.10369262695303,349.3510040283203],[291.4035705566406,344.47023010253906],[287.52327880859366,339.72760620117185],[284.25847778320303,334.55154113769527],[282.05546874999993,328.842251586914],[280.7615112304687,322.8575805664062],[280.3926696777344,316.74834594726565],[281.67342529296866,310.80263977050777],[286.6937377929687,308.1391662597656],[292.31633911132803,310.4984832763672],[297.54984741210933,313.6795654296875],[302.11458740234366,317.7480590820312],[305.6546630859375,322.73805847167966],[308.4351806640625,328.1966186523438],[311.03352050781245,333.7429138183594],[314.95794677734375,333.69758300781245],[315.9708190917968,327.66448364257815],[316.3072753906249,321.54631958007815],[316.40302124023435,315.41933288574216],[317.9300415039062,309.56659545898435],[322.6423522949218,305.83556213378904],[328.53373413085933,304.1573181152344],[334.5149230957031,302.82398986816406],[340.5269592285156,301.6371643066406],[346.5568969726562,300.544482421875],[351.9504516601562,298.43290405273433],[356.1129394531249,293.9405822753906],[360.79290771484375,289.99030761718745],[365.926611328125,286.65155029296875],[371.47773437499995,284.0692962646484],[377.3923583984374,282.505126953125],[383.5004821777343,282.3646270751953],[389.4309143066406,283.83905334472655],[394.8157104492187,286.7339447021484],[399.30598144531245,290.8745361328125],[400.24468383789053,296.55470886230466],[397.0856689453125,301.76845703125],[392.01494140624993,305.0941192626953],[386.30402832031245,307.2912536621094],[380.28853149414056,308.42651062011714],[374.17194824218745,308.74871826171875],[368.0543395996093,308.4210205078125],[361.97065429687495,307.688037109375],[357.06633911132803,306.64468078613277],[361.1900756835937,302.12742919921874],[366.1918884277343,298.601708984375],[369.94340820312493,299.19083862304683],[374.8038452148437,302.4799285888672],[380.34855957031243,300.4600372314453],[381.44645385742183,294.9663146972656],[387.4044433593749,296.12417297363277],[392.9814147949219,298.64394226074216],[398.74372558593745,300.42724609375],[403.7015747070312,297.4380828857422],[403.9962036132812,291.3972290039062],[403.0091369628906,285.34924011230464],[402.64251708984375,279.2382110595703],[403.88717041015616,273.26048278808594],[401.9732788085937,268.73643798828124],[395.90266723632806,267.94028625488284],[389.78121337890616,267.66437072753905],[383.65352172851556,267.63463439941404],[377.5325805664062,267.89346008300777],[371.4659423828125,268.74513244628906],[365.5042785644531,270.15583496093745],[359.6809143066406,272.0588745117187],[354.0162292480468,274.3938812255859],[348.52338256835935,277.1097351074219],[343.62043457031245,280.77003784179686],[338.79033203124993,284.54144592285155],[333.9599731445312,288.3130676269531],[329.1296142578125,292.0846893310547],[324.29951171874995,295.8561187744141],[323.75421752929685,292.17889709472655],[325.15203857421875,286.2121917724609],[326.2870178222656,280.19287109375],[326.1347473144531,274.100064086914],[322.3909606933594,269.54713745117186],[317.4692138671875,265.9944366455078],[314.1346435546875,260.8756866455078],[312.01763916015625,255.13464202880857],[310.9929321289062,249.10226898193358],[312.47504882812495,244.74362182617188],[318.0942321777343,247.1863586425781],[323.8615417480469,249.2546676635742],[329.75655517578116,250.92471923828123],[335.78068237304683,252.02879791259764],[341.8776977539062,251.89610595703124],[342.27777099609375,248.4367263793945],[336.55241699218743,246.25219573974607],[330.9883056640624,243.6953628540039],[326.0599365234375,240.0862869262695],[322.7921020507812,234.96649017333982],[322.2286071777344,228.9247283935547],[327.21879882812493,229.62608489990234],[331.99212036132803,233.46839447021483],[336.8472595214844,237.20517425537108],[342.17412109374993,240.20806274414062],[348.1744506835937,240.87628631591795],[346.29486694335935,236.4704177856445],[341.60614013671875,232.5241485595703],[337.31206054687493,228.1657257080078],[336.02545166015625,222.53406677246093],[340.06147460937495,217.9330108642578],[344.12825927734366,213.3481262207031],[348.1668884277343,208.73898468017578],[352.1873596191406,204.11420593261718],[352.6580993652343,210.1247573852539],[354.25386352539056,216.0289779663086],[357.4114685058594,221.2445098876953],[362.4094360351562,224.68819885253905],[368.42634277343745,225.62681579589844],[374.48456420898435,224.7636505126953],[380.4141845703125,223.22377014160156],[386.1847839355469,221.16715698242186],[391.7491516113281,218.6042999267578],[397.057470703125,215.54647827148438],[402.0472778320312,211.99329681396483],[406.591552734375,207.88880767822263],[411.99933471679685,206.19643249511716],[417.9831298828125,207.3039611816406],[423.0228393554687,210.76351165771484],[428.1295410156249,214.14152221679686],[432.9921997070312,217.82601776123045],[436.7482055664062,222.65522308349608],[439.6164794921874,228.0639236450195],[441.64897460937493,233.83892364501952],[442.6576171874999,239.8729309082031],[441.84542236328116,245.89645996093748],[443.24311523437495,242.34813842773437],[445.6219360351562,236.69987030029296],[448.00041503906243,231.05256347656248],[451.4822998046875,230.236865234375],[453.5729003906249,235.99513854980466],[455.6393188476562,241.7641143798828],[458.23039550781243,247.3118942260742],[462.02604980468743,252.0794906616211],[467.5483764648437,254.6556671142578],[473.5205078125,255.99195404052733],[479.63422851562495,256.2734664916992],[483.25582275390616,258.82833404541014],[483.9606079101562,264.91602478027346],[484.5907958984375,271.01171569824214],[485.18612060546866,277.1112518310547],[485.7676025390624,283.2117492675781],[483.9623168945312,282.747119140625],[480.6554321289062,277.58852844238277],[477.32487792968743,272.446044921875],[472.9918334960937,268.1546997070312],[467.44720458984375,265.6308288574219],[461.42303466796875,264.5395141601563],[455.3064086914062,264.20908203125],[449.191748046875,264.56260681152344],[443.2703735351562,266.04337768554683],[438.5954467773437,269.93650817871094],[435.19243164062493,275.0209075927734],[432.81523437499993,280.658740234375],[431.67611083984366,286.66285095214846],[432.18880615234366,292.6751007080078],[433.989990234375,298.53168334960935],[435.6198486328125,304.43945007324214],[437.2196289062499,310.3543731689453],[438.83709716796875,316.2657928466797],[440.75688476562493,322.08050537109375],[443.0814453124999,327.75085144042964],[445.40361328124993,333.42218017578125],[447.49224853515625,339.18207702636715],[448.69281005859375,345.1869781494141],[448.5034545898437,351.2567138671875],[444.0527465820312,355.07595214843747],[440.40303955078116,353.9306335449219],[442.7123046874999,348.34881286621095],[438.305517578125,349.91612243652344],[434.634619140625,354.75299682617185],[428.9729248046874,356.5582824707031],[425.67843017578116,352.15173034667964],[426.24615478515625,346.66640319824216],[420.19011230468743,346.4689086914062],[416.0701782226562,350.3669525146484],[411.2127746582031,352.8062286376953],[406.6073181152343,349.04404907226564],[406.4782470703125,343.1086395263672],[409.59000854492183,337.84443359374995],[409.18596191406243,335.82037658691405],[404.1574462890625,339.32330322265625],[399.22113037109375,342.9543182373047],[394.55316772460935,346.92125549316404],[390.3188171386719,351.34662780761715],[386.80108642578125,356.35875854492184],[383.88944702148433,361.74799804687495],[381.4509399414062,367.3687835693359],[379.42904052734366,373.15205078124995],[377.89873046874993,379.0831665039062],[380.30668945312493,378.51764221191405],[384.69869384765616,374.24409179687495]];

//Initializing main picture
var picture = Fourier_portrait;

var draw_pic = [];

var c_val = document.getElementById("c_v");
var ShowPic = document.getElementById("show_picture");
var ShowCir = document.getElementById("show_circles");
var ShowLin = document.getElementById("show_lines");
var ShowIns = document.getElementById("inst_calc");
var ZoomEl = document.getElementById("zoom");
var SpeedEl = document.getElementById("speed");
var EdgeLock = document.getElementById("edgelock");

//Canvas initializing
var canv = /** @type {HTMLCanvasElement} */ (document.querySelector('#canvas'))
canv = document.getElementById("MyCanvas");
var ctx = canv.getContext("2d");

var body = document.getElementById("body");

//Inner graphics parameters
canv.width = window.innerWidth - 6;
canv.height = window.innerHeight - 190;
ctx.strokeStyle = "white";
ctx.lineWidth = 0.5;
var offset = [canv.width / 2, canv.height / 2];
var lineoffset = 700;
var scale = 100;

var IsMouseDown = false;

var IsDrawingMode = false;

var last_zoom = 1;
var last_speed = 5;
var last_offset = offset;
var mousepos;

//Delta - time parameter
var dx = 0.005;

//Circles number
//--------------
var n = 250;
//--------------

//Helping arrays
var line = [offset[1]];
var line_track = [];

var pos = [];
var r = [];
var ang = [];

//Initialising components
for(var i = 0; i < n; i++){
    pos.push([0, 0]);
    ang.push(0);
    r.push(0);
}

//Picture graph function initializing
var f_p = [];
for(var i = 0; i < picture.length; i++){
    f_p.push([(picture[i][0] - offset[0]) / (scale), -(picture[i][1] - offset[1]) / (scale)]);
}

//Drawing method
circlesDraw(f_p);

var i_line = Instant_Calc();
var saved_width = window.innerWidth;

window.addEventListener("resize", (e) => {
    if(window.innerWidth == saved_width) return;
    location.reload()
    saved_width = window.innerWidth;
});

window.addEventListener("keydown", (e) => {
    if(e.code == "Enter"){
        Apply();
    }
});

//Interval main function
var interval = setInterval(draw, 10);
function draw(){
    if(!IsDrawingMode)
    {
        
        //Scene clearing
        clear();

        //Setting main circle position
        pos[0] = [offset[0] + Math.cos(ang[0]) * r[0] * scale, offset[1] - Math.sin(ang[0]) * r[0] * scale];

        //Updating angles and positions sinse lifetime
        for(var i = 1; i < n; i++){
            ang[i] += dx * (Math.pow(-1, i % 2) * Math.floor((i + 1) / 2));
            
            pos[i] = [pos[i-1][0] + Math.cos(ang[i]) * r[i] * scale,
                    pos[i-1][1] - Math.sin(ang[i]) * r[i] * scale];

            if(ShowLin.checked){
                ctx.arc(pos[i][0], pos[i][1], 1, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
            }
        }


        //Drawing first circle rotation
        if(ShowLin.checked){
            ctx.arc(pos[0][0], pos[0][1], 1, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
        }

        //Drawing last circle
        ctx.arc(pos[pos.length - 1][0], pos[pos.length - 1][1], 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();


        if(!ShowIns.checked){
            //Line track control
            line_track.push([pos[pos.length - 1][0], pos[pos.length     - 1][1]]);
            if(line_track.length > 1300) line_track.shift();

            //Line track drawing
            ctx.lineWidth = 2;
            drawLine(line_track);
            
        }
        ctx.lineWidth = 0.5;

        //Circles radiuses drawing
        if(ShowLin.checked){
            drawLine(pos);
        }
        ctx.beginPath();

        //Main circles drawing
        if(ShowCir.checked){
            ctx.lineWidth = 0.25;
            ctx.arc(offset[0], offset[1], r[0] * scale, 0, Math.PI * 2);
            ctx.stroke();
            ctx.beginPath();
            for(var i = 1; i < n; i++){
                ctx.arc(pos[i-1][0], pos[i-1][1], r[i] * scale, 0, Math.PI * 2);
                ctx.lineWidth = 0.25;
                ctx.stroke();
                ctx.lineWidth = 0.5;
                ctx.beginPath();
            }
        }
        ctx.beginPath();

        //Target picture drawing
        if(ShowPic.checked) drawLine(picture);

        //Drawing instant line
        ctx.lineWidth = 2;
        if(ShowIns.checked){
            //i_line = Instant_Calc();
            drawLine(i_line);
        }
        ctx.beginPath();


        //Zoom change
        if(ZoomEl.value != last_zoom){
            clear();
            scale = 200 * ZoomEl.value / 2;
            offset = SetPicZoom([offset])[0];
            picture = SetPicZoom(picture);
            line_track = SetPicZoom(line_track);
            i_line = SetPicZoom(i_line);
            last_zoom = ZoomEl.value;
        }


        //Speed change
        if(SpeedEl.value != last_speed){
            dx = SpeedEl.value / 1000;
            last_speed = SpeedEl.value;
        }


        //Tip stabilize
        
        if(EdgeLock.checked){
            offset = [-pos[n - 1][0] + last_offset[0] + canv.width / 2,
                      -pos[n - 1][1] + last_offset[1] + canv.height / 2];
            var d_off = [last_offset[0] - offset[0],
            last_offset[1] - offset[1]];
            picture = PicOffset(picture, d_off);
            line_track = PicOffset(line_track, d_off);
            i_line = PicOffset(i_line, d_off);

            last_offset = offset;
        }
        else{
            last_offset = offset;
        }
    }
}

//Canvas clear function
function clear(){
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canv.width, canv.height);
    ctx.beginPath();
    ctx.fillStyle = "white";
}

//Line drawing function
function drawLine(x){
    ctx.beginPath();
    ctx.moveTo(x[0][0], x[0][1]);
    for(var i = 1; i < x.length; i++){
        ctx.lineTo(x[i][0], x[i][1]);
    }
    ctx.stroke();
    ctx.closePath();
}

function toGraph(y, local_offset){
    var f_p = [];
    for(var i = 0; i < y.length; i++){
        f_p.push([(y[i][0] - local_offset[0] ) / (scale),
        -(y[i][1] - local_offset[1]) / (scale)]);
    }
    return f_p;
}

function toPicture(y, local_offset){
    var p = [];
    for(var i = 0; i < y.length; i++){
        p.push([y[i][0] * scale + local_offset[0], -y[i][1] * scale + local_offset[1]]);
    }
    return p;
}

canv.addEventListener("mousedown", function(e){
    IsMouseDown = true;
});

canv.addEventListener("mouseup", function(e){
    IsMouseDown = false;
});



canv.addEventListener("mousemove", function(e){
    if(IsDrawingMode && IsMouseDown){
        draw_pic.push([e.pageX, e.pageY]);
        ctx.lineTo(e.pageX, e.pageY);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(e.pageX, e.pageY);
    }
    
    if(!IsDrawingMode && IsMouseDown){
        mousepos = [mousepos[0] - e.x, mousepos[1] - e.y];
        offset[0] -= mousepos[0];
        offset[1] -= mousepos[1];
        picture = PicOffset(picture, mousepos);
        line_track = PicOffset(line_track, mousepos);
        i_line = PicOffset(i_line, mousepos);
    }
    mousepos = [e.x, e.y];
});


//Mobile Touches

// let initialDistance = null;
// let scale_m = 1;
    
// function getDistance(touch1, touch2) {
//     const dx = touch1.pageX - touch2.pageX;
//     const dy = touch1.pageY - touch2.pageY;
//     return Math.sqrt(dx * dx + dy * dy);
// }

canv.addEventListener("touchstart", function(e){
    let _x = e.changedTouches[0].pageX;
    let _y = e.changedTouches[0].pageY;
    mousepos = [_x, _y];
    body.style.overflow = "hidden";
    // if (e.touches.length === 2) {
    //     initialDistance = getDistance(e.touches[0], e.touches[1]);
    // }
});

canv.addEventListener("touchend", function(e){
    body.style.overflow = "auto";
    // if (e.touches.length < 2) {
    //     initialDistance = null; 
    // }
});

canv.addEventListener("touchmove", function(e){
    body.style.overflow = "hidden";

    let _x = e.changedTouches[0].pageX;
    let _y = e.changedTouches[0].pageY;

    if(IsDrawingMode){
        draw_pic.push([_x, _y]);
        ctx.lineTo(_x, _y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(_x, _y);
    }
    
    if(!IsDrawingMode){
        mousepos = [mousepos[0] - _x, mousepos[1] - _y];
        offset[0] -= mousepos[0];
        offset[1] -= mousepos[1];
        picture = PicOffset(picture, mousepos);
        line_track = PicOffset(line_track, mousepos);
        i_line = PicOffset(i_line, mousepos);
    }
    mousepos = [_x, _y];

    //Zoom
    // if (e.touches.length === 2) {
    //     const currentDistance = getDistance(e.touches[0], e.touches[1]);
    //     if (initialDistance) {
    //         const scaleChange = currentDistance / initialDistance;
    //         scale_m *= scaleChange;
    //         scale_m = Math.max(0.1, Math.min(100, scale));
    //         ZoomEl.value = `${scale_m}`
    //         initialDistance = currentDistance; 
    //     }
    // }
});


//Mouse wheel scroll zoom
canv.addEventListener('wheel', function(e){
    let delta = e.deltaY;
    if (delta > 0) {
        ZoomEl.value = String(Number.parseFloat(ZoomEl.value) - 1);
    }
    else {
        ZoomEl.value = String(Number.parseFloat(ZoomEl.value) + 1);
    }
});


function setDrawing(){
    IsDrawingMode = true;
    draw_pic = [];
    document.getElementById("c_v").value = "1"
    clear();
}

function Apply(){
    IsDrawingMode = false;
    clear();
    n = Number(c_val.value);
    pos = [];
    ang = [];
    r = [];
    line_track = [];
    for(var i = 0; i < n; i++){
        pos.push([0, 0]);
        ang.push(0);
        r.push(0);
    }

    if(draw_pic.length > 0){
        picture = draw_pic;
    }

    var graph_line = toGraph(picture, offset);
    circlesDraw(graph_line);

    i_line = Instant_Calc();
}

function SetDefault(){
    c_val.value = 250;
    picture = Fourier_portrait;
    draw_pic = [];
    Apply();
}

function Instant_Calc(){
    var x = 0;
    var instantLine = [];
    var pos_h = pos;
    var ang_h = ang;
    var r_h = r;
    while(x < Math.PI * 2){
        x += dx;

        pos_h[0] = [offset[0] + Math.cos(ang_h[0]) * r_h[0] * scale, offset[1] - Math.sin(ang_h[0]) * r[0] * scale];

        for(var i = 1; i < n; i++){
            ang_h[i] += dx * (Math.pow(-1, i % 2) * Math.floor((i + 1) / 2));
            
            pos_h[i] = [pos_h[i-1][0] + Math.cos(ang_h[i]) * r_h[i] * scale,
                    pos_h[i-1][1] - Math.sin(ang_h[i]) * r_h[i] * scale];
        }

        instantLine.push([pos_h[pos_h.length - 1][0], pos_h[pos_h.length - 1][1]]);
    }

    return instantLine;
}

function Plus(){
    c_val.value++;
    Apply();
}

function Minus(){
    if(c_val.value > 0) c_val.value--;
    Apply();
}

function SetPicZoom(x){
    last_offset = offset;
    var y = toGraph(x, [canv.width / 2, canv.height / 2]);

    for(var i = 0; i < y.length; i++){
        y[i][0] = (y[i][0]) * ZoomEl.value / last_zoom;
        y[i][1] = (y[i][1]) * ZoomEl.value / last_zoom;
    }
    return toPicture(y, [canv.width / 2, canv.height / 2]);
}

function PicOffset(x, ofs){
    for(var i = 0; i < x.length; i++){
        x[i][0] -= ofs[0];
        x[i][1] -= ofs[1];
    }
    return x;
}

//Discrete Fourier complex transform 
function dft(x, n){
    var im = 0;
    var re = 0;
    for(var i = 0; i < x.length; i++){
        var arg = 2 * Math.PI * i * n / x.length;
        var a = x[i][0];
        var b = x[i][1];
        var c = Math.cos(arg);
        var d = Math.sin(arg);
        re += (a * c - b * d);
        im += (a * d + b * c);
    }
    return [Math.atan2(im, re), Math.sqrt(im * im + re * re) / x.length];
}

//Setting parameters with circles set 
function circlesDraw(y){
    for(var i = 0; i < n; i++){
        var res = dft(y, -(Math.pow(-1, i % 2) * Math.floor((i + 1) / 2)));
        ang[i] = res[0];
        r[i] = res[1];
    }
}
